(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=15},32:function(t,e,n){t.exports=n(74)},37:function(t,e,n){},38:function(t,e,n){},57:function(t,e){},59:function(t,e){},60:function(t,e){},61:function(t,e){},62:function(t,e){},70:function(t,e,n){},71:function(t,e,n){},72:function(t,e,n){},73:function(t){t.exports={id:"board-001",viewport:{transform:{shiftX:0,shiftY:0,scaleX:2,scaleY:2},size:{width:400,height:400}},pages:[{size:{width:360,height:500},transform:{shiftX:0,shiftY:0,scaleX:0,scaleY:0},id:"page-001",type:"pdf",contentUrl:"https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",pageNumber:10},{size:{width:360,height:500},transform:{shiftX:370,shiftY:0,scaleX:0,scaleY:0},id:"page-002",type:"pdf",contentUrl:"https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",pageNumber:100},{size:{width:360,height:500},transform:{shiftX:750,shiftY:0,scaleX:0,scaleY:0},id:"page-003",type:"pdf",contentUrl:"https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",pageNumber:50}]}},74:function(t,e,n){"use strict";n.r(e);var i=n(3),o=n.n(i),a=n(28),r=n.n(a),s=(n(37),n(1)),c=n(2),l=n(6),h=n(5),u=n(7),p=(n(38),n(0)),d=n.n(p),f=n(9),g=n(20),v=n(29),w=n(31),m={redirectUri:window.location.href},b=new g.UserAgentApplication("aa31273b-0fc3-43c3-8abe-08f3234d2e33",void 0,function(t,e,n,i){},m),k={authProvider:new v.MSALAuthenticationProvider(b,["user.read","mail.send","notes.read","Files.ReadWrite.All"])},y=w.a.initWithMiddleware(k);function j(t,e){var n=new Blob([e],{type:"text/plain"}),i=document.createElement("a");i.download="".concat(t,".html"),i.href=(window.webkitURL||window.URL).createObjectURL(n),i.dataset.downloadurl=["text/plain",i.download,i.href].join(":"),i.click()}function A(t){return P.apply(this,arguments)}function P(){return(P=Object(f.a)(d.a.mark(function t(e){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.api("/me/onenote/pages/".concat(e,"/content?includeinkML=true")).get();case 2:n=t.sent,E(e,n);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function E(t,e){var n=e.getReader(),i="";n.read().then(function e(o){var a=o.done,r=o.value;if(a)return console.log("Stream complete"),void function(t,e){for(var n=e.split("\n"),i=0,o="",a=n[0].slice(0,-1),r=3;r<n.length;r++)n[r].startsWith(a)?(j(t+"_"+i,o),++r<n.length&&(i+=1,o=""),r++):o+=n[r]+"\n"}(t,i);r.length;var s=r;return i+=new TextDecoder("utf-8").decode(s),n.read().then(e)})}function O(t){return x.apply(this,arguments)}function x(){return(x=Object(f.a)(d.a.mark(function t(e){var n,i,o;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],t.prev=1,t.next=4,y.api("/me/onenote/pages").filter("startswith(title,'artifex') or startswith(title,'Artifex')").get();case 4:for(i=t.sent,console.log(i),o=0;o<i.value.length;o++)A(i.value[o].id),n.push(i.value[o].id);t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(1),t.t0;case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}},t,null,[[1,9]])}))).apply(this,arguments)}var C=function(t){function e(){return Object(s.a)(this,e),Object(l.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h2",null,"Download OneNote pages"),o.a.createElement("br",null),o.a.createElement("ul",{style:{textAlign:"left"}},o.a.createElement("li",null,"Click following button to download all OneNote pages which title starts with [Aa]tifex. "),o.a.createElement("li",null,"Check ",o.a.createElement("a",{href:"https://www.w3.org/TR/InkML/"},"inkML")," for standard "),o.a.createElement("li",null,"Check ",o.a.createElement("a",{href:"https://github.com/microsoft/InkMLjs"},"inkMLjs")," for JavaScript render implementation"),o.a.createElement("li",null," Example",o.a.createElement("ul",null,o.a.createElement("li",null,"Response data from Graph API, ",o.a.createElement("a",{href:"https://zhenqiang.li/brext/onenote-page.txt"},"link")),o.a.createElement("li",null,"Rendered view in OneNote, ",o.a.createElement("a",{href:"https://zhenqiang.li/brext/onenote-page.png"},"link"))))),o.a.createElement("button",{onClick:O},"start"),o.a.createElement("br",null),o.a.createElement("br",null))}}]),e}(i.Component),W="/";"http:"!==window.location.protocol&&(W+="brext/");var D=n(56);D.GlobalWorkerOptions.workerSrc=W+"pdf.worker.js";var z=function(){function t(){Object(s.a)(this,t)}return Object(c.a)(t,[{key:"getPdfInfo",value:function(t){}},{key:"getPageAsImg",value:function(){var t=Object(f.a)(d.a.mark(function t(e,n){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n<=1&&(n=1),console.log("PdfjsWrapper#getPageAsImg async  %o %o",e,n),t.abrupt("return",D.getDocument(e).promise.then(function(t){return console.log("PdfjsWrapper#getPageAsImg async  %o",t),t.getPage(n).then(function(t){var e=t.getViewport(2),n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width,n.height=e.height,console.log("getPageAsImg#renderPage start done %o %o",e.width,e.height);var o={canvasContext:i,viewport:e};return t.render(o).promise.then(function(){return n},function(t){return console.log(t)})},function(t){return console.log("getPageAsImg#getDocument error %o",t)})}));case 3:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}]),t}();function U(t){this.width=t.width,this.height=t.height}function S(t){this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shiftX=t.shiftX,this.shiftY=t.shiftY}function X(t){this.x=t.x,this.y=t.y,t.t?this.t=t.t:this.t=Date.now(),this.pressure=t.pressure,this.altitude=t.altitude,this.azimuth=t.azimuth}function R(t){if(t.id?this.id=t.id:this.id="stroke-".concat(Date.now()),this.points=[],t.points)for(var e=0;e<t.points.length;e++)this.points.push(new X(t.points[e]))}function L(t){if(t.id?this.id=t.id:this.id="writing-".concat(Date.now()),this.strokes=[],t.strokes)for(var e=0;e<t.strokes.length;e++)this.strokes.push(new R(this.strokes[e]))}function M(t){this.transform=new S(t.transform),this.size=new U(t.size)}function N(t){if(t.id?this.id=t.id:this.id="board-".concat(Date.now()),this.viewport=new M(t.viewport),t.writing&&(this.writing=new L(t.writing)),t.pages){this.pages=[];for(var e=0;e<t.pages.length;e++)this.pages.push(t.pages[e])}}n(70),n(71),n(27);var Y=function(){function t(e){Object(s.a)(this,t),this.svg=e,this.initPath()}return Object(c.a)(t,[{key:"initPath",value:function(){this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("stroke","black"),this.path.setAttribute("fill","none"),this.path.setAttribute("stroke-width","2"),this.d=""}},{key:"startAction",value:function(t,e){console.log("Drawable#startAction (%o, %o)",t,e),this.initPath(),this.d="M ".concat(t," ").concat(e),this.svg.append(this.path),this.previousPoint={x:t,y:e}}},{key:"updateAction",value:function(t,e){this.previousPoint&&this.d.startsWith("M")&&(this.d="".concat(this.d," C ").concat(t," ").concat(e," \n                        ").concat(this.previousPoint.x," ").concat(this.previousPoint.y,"\n                        ").concat((t+this.previousPoint.x)/2," ").concat((e+this.previousPoint.y)/2," "),this.path.setAttribute("d","".concat(this.d)),this.previousPoint={x:t,y:e})}},{key:"endAction",value:function(t,e){this.initPath()}}]),t}(),I=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(h.a)(e).call(this,t))).writingCanvas=o.a.createRef(),n.currentActioner=null,n.writing=new L({}),n}return Object(u.a)(e,t),Object(c.a)(e,[{key:"startAction",value:function(t,e,n){console.log("WL#startAction %o %o %o",t,e,n),"touch"!==n&&this.currentActioner&&this.currentActioner.startAction(t,e)}},{key:"updateAction",value:function(t,e,n){this.currentActioner&&this.currentActioner.updateAction(t,e)}},{key:"endAction",value:function(t,e,n){console.log("WL#endAction %o %o %o",t,e,n),this.currentActioner&&this.currentActioner.endAction(t,e)}},{key:"onPointerDown",value:function(t){console.log("WL#pointerDown %o %o",this.element,t);var e=this.element.getBoundingClientRect();this.startAction(t.clientX-e.left,t.clientY-e.top,t.pointerType),t.preventDefault(),t.stopPropagation()}},{key:"onPointerMove",value:function(t){var e=this.element.getBoundingClientRect();this.updateAction(t.clientX-e.left,t.clientY-e.top,t.pointerType),t.preventDefault(),t.stopPropagation()}},{key:"onPointerUp",value:function(t){console.log("WL#pointerUp %o %o",this.element,t);var e=this.element.getBoundingClientRect();this.endAction(t.clientX-e.left,t.clientY-e.top,t.pointerType),t.preventDefault(),t.stopPropagation()}},{key:"componentDidMount",value:function(){console.log("WritingLayer#componentDidMount %o",this.writingCanvas.current),this.element=this.writingCanvas.current,this.currentActioner=new Y(this.element)}},{key:"render",value:function(){return o.a.createElement("div",{style:{width:"100%",height:"100%"}},o.a.createElement("svg",{ref:this.writingCanvas,style:{width:"100%",height:"100%"},"touch-action":"none",onPointerDown:this.onPointerDown.bind(this),onPointerMove:this.onPointerMove.bind(this),onPointerUp:this.onPointerUp.bind(this)}))}}]),e}(i.Component),T=(n(72),function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(h.a)(e).call(this,t))).state={canvas:null,pdfjsWrapper:new z},n}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){console.log("Page#componentDidMount"),this.loadPage()}},{key:"componentDidUpdate",value:function(){console.log("Page#componentDidUpdate")}},{key:"componentWillUnmount",value:function(){console.log("Page#componentWillUnmount")}},{key:"componentWillReceiveProps",value:function(){console.log("Page#componentWillReceiveProps")}},{key:"loadPage",value:function(){var t=this;this.state.pdfjsWrapper.getPageAsImg(this.props.data.contentUrl,this.props.data.pageNumber).then(function(e){t.setState({canvas:e})})}},{key:"render",value:function(){return this.state.canvas?o.a.createElement("div",{style:{position:"absolute",top:this.props.data.transform.shiftY*this.props.scale,left:this.props.data.transform.shiftX*this.props.scale,width:this.props.data.size.width*this.props.scale,height:this.props.data.size.height*this.props.scale,borderColor:"black",borderStyle:"dashed",borderWidth:"2px",backgroundImage:'url("'.concat(this.state.canvas.toDataURL("image/png"),'")'),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain"},id:"page"+this.props.data.pageNumber},o.a.createElement(I,null)):o.a.createElement("div",null,"loading")}}]),e}(i.Component)),B=function(t){function e(){return Object(s.a)(this,e),Object(l.a)(this,Object(h.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){var t=this.props.data;return console.log("Board#render %o",t),o.a.createElement("div",null,t.pages.map(function(e){return o.a.createElement(T,{key:e.id,data:e,scale:t.viewport.transform.scaleX})}))}}]),e}(i.Component),q=n(73),J=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(l.a)(this,Object(h.a)(e).call(this,t))).state={current:1,canvas:null,scale:1,pdfjsWrapper:new z},n.board=new N(q),n}return Object(u.a)(e,t),Object(c.a)(e,[{key:"loadPage",value:function(){var t=this;this.state.pdfjsWrapper.getPageAsImg("https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",this.state.current).then(function(e){t.setState({canvas:e})})}},{key:"handleScaleChange",value:function(t){console.log("App#handleScaleChange %o",t.target.value),this.board.viewport.transform.scaleX=Number(t.target.value),this.setState({board:this.board})}},{key:"handleScaleDown",value:function(){this.board.viewport.transform.scaleX=this.board.viewport.transform.scaleX-.1,this.setState({board:this.board})}},{key:"handleScaleUp",value:function(){this.board.viewport.transform.scaleX=this.board.viewport.transform.scaleX+.1,this.setState({board:this.board})}},{key:"render",value:function(){return window.location.pathname===W+"msapi"?o.a.createElement("div",{className:"App"},o.a.createElement(C,null)):o.a.createElement("div",{className:"App"},o.a.createElement(B,{data:this.board}),o.a.createElement("div",{style:{position:"absolute",top:"0px",left:"0px"}},o.a.createElement("input",{type:"text",value:this.board.viewport.transform.scaleX,onChange:this.handleScaleChange.bind(this),placeholder:"Write a scale number..."}),o.a.createElement("button",{onClick:this.handleScaleDown.bind(this)},"Scale-"),o.a.createElement("button",{onClick:this.handleScaleUp.bind(this)},"Scale+")))}}]),e}(i.Component),_=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function F(t,e){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var n=t.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(function(t){console.error("Error during service worker registration:",t)})}r.a.render(o.a.createElement(J,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("/brext",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/brext","/service-worker.js");_?(function(t,e){fetch(t).then(function(n){var i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):F(t,e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):F(e,t)})}}()}},[[32,1,2]]]);
//# sourceMappingURL=main.03a4aa2d.chunk.js.map