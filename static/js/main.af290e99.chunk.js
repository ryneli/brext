(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=13},33:function(t,e,n){t.exports=n(75)},38:function(t,e,n){},39:function(t,e,n){},57:function(t,e,n){},59:function(t,e){},61:function(t,e){},62:function(t,e){},63:function(t,e){},64:function(t,e){},72:function(t,e,n){},73:function(t,e,n){},74:function(t){t.exports={id:"board-001",viewport:{transform:{shiftX:0,shiftY:0,scaleX:2,scaleY:2},size:{width:400,height:400}},pages:[{size:{width:360,height:500},transform:{shiftX:0,shiftY:0,scaleX:0,scaleY:0},id:"page-001",type:"pdf",contentUrl:"https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",pageNumber:10},{size:{width:360,height:500},transform:{shiftX:370,shiftY:0,scaleX:0,scaleY:0},id:"page-002",type:"pdf",contentUrl:"https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",pageNumber:100},{size:{width:360,height:500},transform:{shiftX:750,shiftY:0,scaleX:0,scaleY:0},id:"page-003",type:"pdf",contentUrl:"https://zhenqiang.li/pdf/zaijidulizhangjin.pdf",pageNumber:50}]}},75:function(t,e,n){"use strict";n.r(e);var o=n(1),i=n.n(o),a=n(29),r=n.n(a),s=(n(38),n(6)),c=(n(39),n(0)),l=n.n(c),u=n(2),h=n(3),p=n(15),d=n(14),f=n(16),g=n(7),w=n(21),v=n(30),m=n(32),b={redirectUri:window.location.href},k=new w.UserAgentApplication("aa31273b-0fc3-43c3-8abe-08f3234d2e33",void 0,function(t,e,n,o){},b),P={authProvider:new v.MSALAuthenticationProvider(k,["user.read","mail.send","notes.read","Files.ReadWrite.All"])},y=m.a.initWithMiddleware(P);function x(t,e){var n=new Blob([e],{type:"text/plain"}),o=document.createElement("a");o.download="".concat(t,".html"),o.href=(window.webkitURL||window.URL).createObjectURL(n),o.dataset.downloadurl=["text/plain",o.download,o.href].join(":"),o.click()}function E(t){return j.apply(this,arguments)}function j(){return(j=Object(g.a)(l.a.mark(function t(e){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.api("/me/onenote/pages/".concat(e,"/content?includeinkML=true")).get();case 2:n=t.sent,O(e,n);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function O(t,e){var n=e.getReader(),o="";n.read().then(function e(i){var a=i.done,r=i.value;if(a)return console.log("Stream complete"),void function(t,e){for(var n=e.split("\n"),o=0,i="",a=n[0].slice(0,-1),r=3;r<n.length;r++)n[r].startsWith(a)?(x(t+"_"+o,i),++r<n.length&&(o+=1,i=""),r++):i+=n[r]+"\n"}(t,o);r.length;var s=r;return o+=new TextDecoder("utf-8").decode(s),n.read().then(e)})}function D(t){return T.apply(this,arguments)}function T(){return(T=Object(g.a)(l.a.mark(function t(e){var n,o,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],t.prev=1,t.next=4,y.api("/me/onenote/pages").filter("startswith(title,'artifex') or startswith(title,'Artifex')").get();case 4:for(o=t.sent,console.log(o),i=0;i<o.value.length;i++)E(o.value[i].id),n.push(o.value[i].id);t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(1),t.t0;case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}},t,null,[[1,9]])}))).apply(this,arguments)}var A=function(t){function e(){return Object(u.a)(this,e),Object(p.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(h.a)(e,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("h2",null,"Download OneNote pages"),i.a.createElement("br",null),i.a.createElement("ul",{style:{textAlign:"left"}},i.a.createElement("li",null,"Click following button to download all OneNote pages which title starts with [Aa]tifex. "),i.a.createElement("li",null,"Check ",i.a.createElement("a",{href:"https://www.w3.org/TR/InkML/"},"inkML")," for standard "),i.a.createElement("li",null,"Check ",i.a.createElement("a",{href:"https://github.com/microsoft/InkMLjs"},"inkMLjs")," for JavaScript render implementation"),i.a.createElement("li",null," Example",i.a.createElement("ul",null,i.a.createElement("li",null,"Response data from Graph API, ",i.a.createElement("a",{href:"https://zhenqiang.li/brext/onenote-page.txt"},"link")),i.a.createElement("li",null,"Rendered view in OneNote, ",i.a.createElement("a",{href:"https://zhenqiang.li/brext/onenote-page.png"},"link"))))),i.a.createElement("button",{onClick:D},"start"),i.a.createElement("br",null),i.a.createElement("br",null))}}]),e}(o.Component),X="/";function Y(t){this.width=t.width,this.height=t.height}function z(t){this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shiftX=t.shiftX,this.shiftY=t.shiftY}function S(t){this.x=t.x,this.y=t.y,t.t?this.t=t.t:this.t=Date.now(),this.pressure=t.pressure,this.tiltX=t.tiltX,this.tiltY=t.tiltY}function U(t){if(t.id?this.id=t.id:this.id="stroke-".concat(Date.now()),this.points=[],t.points)for(var e=0;e<t.points.length;e++)this.points.push(new S(t.points[e]))}function W(t){if(t.id?this.id=t.id:this.id="writing-".concat(Date.now()),this.strokes=[],t.strokes)for(var e=0;e<t.strokes.length;e++)this.strokes.push(new U(this.strokes[e]))}function L(t){this.transform=new z(t.transform),this.size=new Y(t.size)}function I(t){if(t.id?this.id=t.id:this.id="board-".concat(Date.now()),this.viewport=new L(t.viewport),t.writing&&(this.writing=new W(t.writing)),this.pages=[],t.pages)for(var e=0;e<t.pages.length;e++)this.pages.push(t.pages[e]);if(this.books=[],t.books)for(var n=0;n<t.books.length;n++)this.books.push(t.books[n])}"http:"!==window.location.protocol&&(X+="brext/");n(57);var M=n(58);M.GlobalWorkerOptions.workerSrc=X+"pdf.worker.js";var C=function(){function t(){Object(u.a)(this,t)}return Object(h.a)(t,[{key:"getPdfInfo",value:function(t){}},{key:"getPageAsImg",value:function(){var t=Object(g.a)(l.a.mark(function t(e,n){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n<=1&&(n=1),console.log("PdfjsWrapper#getPageAsImg async  %o %o",e,n),t.abrupt("return",M.getDocument(e).promise.then(function(t){return console.log("PdfjsWrapper#getPageAsImg async  %o",t),t.getPage(n).then(function(t){var e=t.getViewport(2),n=document.createElement("canvas"),o=n.getContext("2d");n.width=e.width,n.height=e.height,console.log("getPageAsImg#renderPage start done %o %o",e.width,e.height);var i={canvasContext:o,viewport:e};return t.render(i).promise.then(function(){return n},function(t){return console.log(t)})},function(t){return console.log("getPageAsImg#getDocument error %o",t)})}));case 3:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),N=(n(72),n(28),function(){function t(e){Object(u.a)(this,t),this.svg=e,this.initPath()}return Object(h.a)(t,[{key:"initPath",value:function(){this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("stroke","black"),this.path.setAttribute("fill","none"),this.path.setAttribute("stroke-width","1"),this.d=""}},{key:"componentDidUpdate",value:function(){console.log("WL#componentDidUpdate")}},{key:"startAction",value:function(t,e){console.log("Drawable#startAction (%o, %o)",t,e),this.initPath(),this.d="M ".concat(t," ").concat(e),this.svg.append(this.path),this.previousPoint={x:t,y:e}}},{key:"updateAction",value:function(t,e){this.previousPoint&&this.d.startsWith("M")&&(this.d="".concat(this.d," Q ").concat(this.previousPoint.x," ").concat(this.previousPoint.y,"\n                        ").concat((t+this.previousPoint.x)/2," ").concat((e+this.previousPoint.y)/2," "),this.path.setAttribute("d","".concat(this.d)),this.previousPoint={x:t,y:e})}},{key:"endAction",value:function(t,e){this.initPath()}}]),t}());var R=function(){var t=i.a.createRef(),e=Object(o.useState)(null),n=Object(s.a)(e,2),a=n[0],r=n[1],c=Object(o.useState)(new W({})),l=Object(s.a)(c,2),u=l[0],h=l[1],p=Object(o.useState)(new U({})),d=Object(s.a)(p,2),f=d[0],g=d[1];function w(e){var n=t.current.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top,t:Date.now(),pressure:e.pressure,tiltX:e.tiltX,tiltY:e.tiltY}}function v(){f.points.length>0&&(u.strokes.push(f),h(u),console.log("WL#tryUpdateWriting %o",u)),g(new U({}))}return Object(o.useEffect)(function(){function e(){console.log("WritingLayer#componentCleanup %o",u),localStorage.setItem("test",JSON.stringify(u))}return console.log("WritingLayer#componentDidMount %o",t.current),r(new N(t.current)),window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}},[]),i.a.createElement("div",{style:{width:"100%",height:"100%"}},i.a.createElement("svg",{ref:t,style:{width:"100%",height:"100%"},"touch-action":"none",onPointerDown:function(t){if(console.log("WL#onPointerDown %o",t.pointerType),"pen"===t.pointerType){v();var e=w(t);f.points.push(e),g(f),n=e.x,o=e.y,a&&a.startAction(n,o),t.preventDefault(),t.stopPropagation()}var n,o},onPointerMove:function(t){if("pen"===t.pointerType){var e=w(t);f.points.push(e),g(f),n=e.x,o=e.y,a&&a.updateAction(n,o),t.preventDefault(),t.stopPropagation()}var n,o},onPointerUp:function(t){if("pen"===t.pointerType){var e=w(t);f.points.push(e),g(f),v(),n=e.x,o=e.y,a&&a.endAction(n,o),t.preventDefault(),t.stopPropagation()}var n,o}}))},q=100,Q=200,G=10,B=10;function J(t,e,n,o,i,a,r){return{type:t,startX:e,startY:n,startTime:o,endX:i,endY:a,endTime:r}}var F="tap",H="press",Z="swipe",_="drag",V=function(){function t(e){Object(u.a)(this,t),this.ssQueue=[],this.inProgress=null,this.startTime=null,this.startX=null,this.startY=null,this.onPress=e.onPress,this.onTap=e.onTap,this.onDoubleTap=e.onDoubleTap}return Object(h.a)(t,[{key:"onEndOfssSequence",value:function(){if(0!==this.ssQueue.length){var t=this.ssQueue;if(this.inProgress=null,this.ssQueue=[],1===t.length){var e=t[0];switch(e.type){case H:this.onPress&&this.onPress(e);case F:this.onTap&&this.onTap(e);default:console.log("Gesture#onEndOfssSequence do not know how to handle %o",e)}}else 2===t.length&&this.onDoubleTap&&t[0].type===F&&t[1].type===F&&this.onDoubleTap(t[1])}else console.log("Gesture#onEndOfssSequence nothing happens")}},{key:"onPointerDown",value:function(t){console.log("Gesture#onPointerDown %o",t.pointerType),this.startTime=Date.now(),this.startX=t.clientX,this.startY=t.clientY,this.inProgress&&window.clearTimeout(this.inProgress),t.preventDefault(),t.stopPropagation()}},{key:"onPointerMove",value:function(t){t.preventDefault(),t.stopPropagation()}},{key:"onPointerUp",value:function(t){t.preventDefault(),t.stopPropagation(),this.inProgress=window.setTimeout(this.onEndOfssSequence.bind(this),250);var e=t.clientX,n=t.clientY,o=Date.now(),i=Math.pow(t.clientX-this.startX,2)+Math.pow(t.clientY-this.startY,2),a=o-this.startTime;console.log("Gesture#onPointerUp %o %o",a,i),a<=q&&i<=G?this.ssQueue.push(J(F,this.startX,this.startY,this.startTime,e,n,o)):a<=q&&i>B?this.ssQueue.push(J(Z,this.startX,this.startY,this.startTime,e,n,o)):a>Q&&i<=G?this.ssQueue.push(J(H,this.startX,this.startY,this.startTime,e,n,o)):a>Q&&i>G&&this.ssQueue.push(J(_,this.startX,this.startY,this.startTime,e,n,o))}}]),t}();n(73);var $=function(t){var e=new C,n=Object(o.useState)(null),a=Object(s.a)(n,2),r=a[0],c=a[1],l=Object(o.useState)({top:t.data.transform.shiftY*t.scale,left:t.data.transform.shiftX*t.scale,width:t.data.size.width*t.scale,height:t.data.size.height*t.scale,zIndex:1,alterTop:"0px",alterLeft:"0px",alterWidth:"100vw",alterHeight:"100vh",alterZIndex:98}),u=Object(s.a)(l,2),h=u[0],p=u[1];Object(o.useEffect)(function(){console.log("Page#componentDidMount"),e.getPageAsImg(t.data.contentUrl,t.data.pageNumber).then(function(t){c(t)})},[]);var d=new V({onDoubleTap:function(t){console.log("Page#onDoubleTap %o",t);var e={top:h.alterTop,left:h.alterLeft,width:h.alterWidth,height:h.alterHeight,zIndex:h.alterZIndex,alterTop:h.top,alterLeft:h.left,alterWidth:h.width,alterHeight:h.height,alterZIndex:h.zIndex};p(e)}});return r?i.a.createElement("div",null,i.a.createElement("div",{style:{position:"absolute",top:h.top,left:h.left,width:h.width,height:h.height,zIndex:h.zIndex,boxShadow:"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)",backgroundColor:"#6DB3F2",backgroundImage:'url("'.concat(r.toDataURL("image/png"),'")'),backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"contain"},id:"page"+t.data.pageNumber,onPointerDown:d.onPointerDown.bind(d),onPointerMove:d.onPointerMove.bind(d),onPointerUp:d.onPointerUp.bind(d)},i.a.createElement(R,{scale:t.scale}))):i.a.createElement("div",null,"loading")};var K=function(t){var e=t.data;return i.a.createElement("div",{"touch-action":"none",style:{position:"absolute",width:"100%",height:"100%"}},e.pages.map(function(t){return i.a.createElement($,{key:t.id,data:t,scale:e.viewport.transform.scaleX})}))},tt=n(74);var et=function(){var t=Object(o.useState)(1),e=Object(s.a)(t,2),n=e[0],a=e[1],r=Object(o.useState)(new I(tt)),c=Object(s.a)(r,2),l=c[0],u=c[1],h=new V({onTap:function(t){console.log("App#onTap %o",t)}});return window.location.pathname===X+"msapi"?i.a.createElement("div",{className:"App"},i.a.createElement(A,null)):i.a.createElement("div",{className:"App"},i.a.createElement(K,{data:l}),i.a.createElement("div",{style:{position:"fixed",top:"0px",left:"0px",zIndex:99},onPointerDown:h.onPointerDown.bind(h),onPointerMove:h.onPointerMove.bind(h),onPointerUp:h.onPointerUp.bind(h)},i.a.createElement("input",{type:"text",value:n,onChange:function(t){console.log("App#handleScaleChange %o",t.target.value),a(Number(t.target.value)),l.viewport.transform.scaleX=Number(t.target.value),u(l)},placeholder:"Write a scale number..."}),i.a.createElement("button",{onClick:function(){a(n-.1),l.viewport.transform.scaleX=n-.1,u(l)}},"Scale-"),i.a.createElement("button",{onClick:function(){a(n+.1),l.viewport.transform.scaleX=n+.1,u(l)}},"Scale+")))},nt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ot(t,e){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var n=t.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(function(t){console.error("Error during service worker registration:",t)})}r.a.render(i.a.createElement(et,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("/brext",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/brext","/service-worker.js");nt?(function(t,e){fetch(t).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):ot(t,e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):ot(e,t)})}}()}},[[33,1,2]]]);
//# sourceMappingURL=main.af290e99.chunk.js.map